{"version":3,"file":"sw.js","sources":["../src/js/utils/storage.js","../src/js/sw/index.js"],"sourcesContent":["export const idbKeyval = (() => {\n  let dbInstance;\n\n  function getDB() {\n    if (dbInstance) return dbInstance;\n\n    dbInstance = new Promise((resolve, reject) => {\n      const openreq = indexedDB.open('svgo-keyval', 1);\n\n      openreq.onerror = () => {\n        reject(openreq.error);\n      };\n\n      openreq.onupgradeneeded = () => {\n        // First time setup: create an empty object store\n        openreq.result.createObjectStore('keyval');\n      };\n\n      openreq.onsuccess = () => {\n        resolve(openreq.result);\n      };\n    });\n\n    return dbInstance;\n  }\n\n  async function withStore(type, callback) {\n    const db = await getDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction('keyval', type);\n      transaction.oncomplete = () => resolve();\n      transaction.onerror = () => reject(transaction.error);\n      callback(transaction.objectStore('keyval'));\n    });\n  }\n\n  return {\n    async get(key) {\n      let request;\n      await withStore('readonly', (store) => {\n        request = store.get(key);\n      });\n      return request.result;\n    },\n    set(key, value) {\n      return withStore('readwrite', (store) => {\n        store.put(value, key);\n      });\n    },\n    delete(key) {\n      return withStore('readwrite', (store) => {\n        store.delete(key);\n      });\n    },\n  };\n})();\n","/* globals SVGOMG_VERSION:false */\n\nimport { idbKeyval as storage } from '../utils/storage.js';\n\nconst version = SVGOMG_VERSION;\nconst cachePrefix = 'svgomg-';\nconst staticCacheName = `${cachePrefix}static-${version}`;\nconst fontCacheName = `${cachePrefix}fonts`;\nconst expectedCaches = new Set([staticCacheName, fontCacheName]);\n\naddEventListener('install', (event) => {\n  event.waitUntil(\n    (async () => {\n      const activeVersionPromise = storage.get('active-version');\n      const cache = await caches.open(staticCacheName);\n\n      await cache.addAll([\n        './',\n        'all.css',\n        'changelog.json',\n        'fonts/code-latin.woff2',\n        'imgs/icon.png',\n        'js/gzip-worker.js',\n        'js/page.js',\n        'js/prism-worker.js',\n        'js/svgo-worker.js',\n        'test-svgs/car-lite.svg',\n      ]);\n\n      const activeVersion = await activeVersionPromise;\n\n      // If it's a major version change, don't skip waiting\n      if (\n        !activeVersion ||\n        activeVersion.split('.')[0] === version.split('.')[0]\n      ) {\n        self.skipWaiting();\n      }\n    })(),\n  );\n});\n\naddEventListener('activate', (event) => {\n  event.waitUntil(\n    (async () => {\n      // remove caches beginning \"svgomg-\" that aren't in expectedCaches\n      const cacheNames = await caches.keys();\n\n      await Promise.all(\n        cacheNames\n          .filter(\n            (cacheName) =>\n              cacheName.startsWith(cachePrefix) &&\n              !expectedCaches.has(cacheName),\n          )\n          .map((cacheName) => caches.delete(cacheName)),\n      );\n\n      await storage.set('active-version', version);\n    })(),\n  );\n});\n\nasync function handleFontRequest(request) {\n  const match = await caches.match(request);\n  if (match) return match;\n\n  const [response, fontCache] = await Promise.all([\n    fetch(request),\n    caches.open(fontCacheName),\n  ]);\n\n  fontCache.put(request, response.clone());\n  return response;\n}\n\naddEventListener('fetch', (event) => {\n  const url = new URL(event.request.url);\n\n  if (url.pathname.endsWith('.woff2')) {\n    event.respondWith(handleFontRequest(event.request));\n    return;\n  }\n\n  event.respondWith(\n    caches\n      .match(event.request)\n      .then((response) => response || fetch(event.request)),\n  );\n});\n"],"names":["storage"],"mappings":"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"}